name: Test AttachmentAV Scan

on:
  push:
    branches:
      - main

jobs:
  scan_file:
    name: Scan file for malware
    runs-on: ubuntu-latest

    env:
      ACTIONS_STEP_DEBUG: true
      NODE_DEBUG: fetch

    steps:
      # Checkout the repository to access files
      - name: Checkout
        uses: actions/checkout@v6

      # Scan the .gitignore file as a test
      - name: Scan .gitignore file
        id: scan
        uses: ./ # Uses the action in the root directory
        with:
          local-file-path: .gitignore
          api-key: ${{ secrets.ATTACHMENTAV_API_KEY }}
          fail-on-infected: true

      # Display scan results
      - name: Display scan results
        run: |
          echo "Scan status: ${{ steps.scan.outputs.status }}"
          echo "File size: ${{ steps.scan.outputs.file-size }} bytes"
          echo "Real file type: ${{ steps.scan.outputs.real-file-type }}"
          if [ -n "${{ steps.scan.outputs.finding }}" ]; then
            echo "Finding: ${{ steps.scan.outputs.finding }}"
          fi
